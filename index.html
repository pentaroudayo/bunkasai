<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#020203">
  <title>MI Prop Control</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="MI Prop">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="background"></div>
  <div id="app" class="app-shell">
    <section id="adminScreen" class="screen screen--admin active" aria-label="運営設定画面">
      <div class="screen-inner">
        <header class="admin-header">
          <p class="tagline">CLASS CULTURE FESTIVAL — MISSION IMPOSSIBLE</p>
          <h1 class="title">運営画面</h1>
          <p class="subtitle">運営開始ボタンを押すと来場者向けの爆弾画面に切り替わります。</p>
        </header>
        <div class="admin-primary">
          <button id="startButton" class="btn btn--primary btn--xl" type="button">運営開始</button>
        </div>
        <section class="ranking-panel" aria-label="ミッションタイムランキング">
          <header class="ranking-header">
            <div class="ranking-header-text">
              <h2>ミッションタイムランキング</h2>
              <p id="rankingDescription" aria-live="polite">記録はありません。</p>
            </div>
            <div class="ranking-controls">
              <button id="clearRankingButton" type="button" class="ranking-action ranking-action--all" aria-label="ランキングを全て消去">全消去</button>
            </div>
          </header>
          <div id="rankingList" class="ranking-list" role="list"></div>
        </section>
        <div class="admin-content">
          <form class="config-grid">
            <fieldset class="config-field">
              <legend>タイマー時間</legend>
              <div class="time-inputs">
                <label class="time-cell"><span>分</span><input id="minutesInput" type="number" min="0" max="59" value="4"></label>
                <label class="time-cell"><span>秒</span><input id="secondsInput" type="number" min="0" max="59" value="0"></label>
              </div>
              <p class="hint">デフォルトは4分です。必要に応じて調整してください。</p>
            </fieldset>
            <fieldset class="config-field">
              <legend>解除コード</legend>
              <label class="code-input"><span>4桁コード</span><input id="codeInput" type="text" inputmode="numeric" pattern="\d{4}" maxlength="4" value="2580"></label>
              <p class="hint">テンキーで入力します。数字は4桁固定です。</p>
            </fieldset>
            <fieldset class="config-field">
              <legend>BGM設定</legend>
              <div class="choice-group">
                <label><input type="radio" name="bgm-source" id="bgm-source-default" value="default" checked> デフォルトBGM</label>
                <label><input type="radio" name="bgm-source" id="bgm-source-custom" value="custom"> カスタムBGM</label>
              </div>
              <label class="file-picker" id="custom-bgm-picker" style="display: none;">
                <input id="bgmInput" type="file" accept="audio/*">
                <span class="file-button">ファイルを選択</span>
              </label>
              <div id="bgmStatus" class="file-status">デフォルトBGM</div>
              <p class="hint">再生するBGMを選択します。</p>
            </fieldset>
            <fieldset class="config-field">
              <legend>BGM再生</legend>
                <label class="toggle-switch">
                    <input type="checkbox" id="bgm-enabled-toggle" checked>
                    <span class="slider"></span>
                    BGMを再生する
                </label>
                <p class="hint">BGMを再生するかどうかを設定します。</p>
            </fieldset>
            <fieldset class="config-field">
              <legend>BGMボリューム</legend>
              <label class="volume-control">
                <span>音量</span>
                <input type="range" id="bgm-volume-slider" min="0" max="100" value="50">
              </label>
              <p class="hint">BGMの再生音量を調整します。（爆弾画面で反映されます）</p>
            </fieldset>
            <fieldset class="config-field">
              <legend>効果音ボリューム</legend>
              <label class="volume-control">
                <span>音量</span>
                <input type="range" id="sfx-volume-slider" min="0" max="100" value="100">
              </label>
              <p class="hint">BEEP音などの効果音の音量を調整します。</p>
            </fieldset>
            <fieldset class="config-field">
              <legend>爆発演出動画</legend>
              <label class="file-picker">
                <input id="videoInput" type="file" accept="video/*">
                <span class="file-button">ファイルを選択</span>
              </label>
              <div id="videoStatus" class="file-status">未選択</div>
              <p class="hint">時間切れ時に全画面で再生されます。</p>
            </fieldset>
            <fieldset class="config-field">
              <legend>評価しきい値</legend>
              <div class="thresholds">
                <div class="threshold-row">
                  <span class="threshold-label">ハイスピード判定</span>
                  <label><input id="fastMinutesInput" type="number" min="0" max="9" value="1">分</label>
                  <label><input id="fastSecondsInput" type="number" min="0" max="59" value="30">秒以内</label>
                </div>
                <div class="threshold-row">
                  <span class="threshold-label">ノーマル判定</span>
                  <label><input id="normalMinutesInput" type="number" min="0" max="9" value="3">分</label>
                  <label><input id="normalSecondsInput" type="number" min="0" max="59" value="0">秒以内</label>
                </div>
              </div>
              <div class="video-pickers">
                <label class="file-picker">
                  <input id="fastVideoInput" type="file" accept="video/*">
                  <span class="file-button">ハイスピード動画</span>
                </label>
                <div id="fastVideoStatus" class="file-status">未選択</div>
                <label class="file-picker">
                  <input id="normalVideoInput" type="file" accept="video/*">
                  <span class="file-button">ノーマル動画</span>
                </label>
                <div id="normalVideoStatus" class="file-status">未選択</div>
                <label class="file-picker">
                  <input id="slowVideoInput" type="file" accept="video/*">
                  <span class="file-button">スロー動画</span>
                </label>
                <div id="slowVideoStatus" class="file-status">未選択</div>
              </div>
              <p class="hint">クリアタイムに応じて再生される動画を設定できます。</p>
            </fieldset>
            <div id="save-settings-card" class="config-field">
                <p>設定内容を保存または破棄します。</p>
                <button id="save-button" type="button" class="btn">保存</button>
                <button id="cancel-button" type="button" class="btn btn--danger">変更を破棄</button>
            </div>
          </form>
        </div>
        <footer class="admin-footer">
          <p>iPad 1台で演出・BGM・運営サポートを完結できます。</p>
        </footer>
      </div>
    </section>

    <section id="bombScreen" class="screen screen--bomb" aria-label="爆弾演出画面">
      <div class="stage">
        <div class="stage-inner">
          <div class="status-top">
            <div id="statusLabel" class="status-chip status-chip--ready">待機</div>
            <button id="abortButton" class="btn btn--ghost abort-button" type="button">
              <span id="abortProgress" class="abort-progress"></span>
              <span class="abort-label">中止して運営へ</span>
            </button>
          </div>
          <div class="stage-grid">
            <div class="visual-column">
              <div class="display-stack">
                <div id="timerArea" class="timer-area">
                  <div id="timerDisplay" class="seven-display" aria-live="polite" aria-atomic="true"></div>
                </div>
                <div id="logArea" class="log-area hidden" aria-live="polite">
                  <div class="log-screen" id="logOutput"></div>
                </div>
                <div id="resultArea" class="result-area hidden">
          <h2 id="resultTitle"></h2>
          <p id="resultSubtitle"></p>
          <p id="resultCaption" class="result-caption hidden" aria-live="polite"></p>
          <div id="playerResult" class="player-result hidden">
            <p class="result-self"><span class="label">あなたたち</span><span id="playerTime">--:--.--</span></p>
            <p class="result-self"><span class="label">順位</span><span id="playerRank">-</span></p>
          </div>
          <div id="resultLeaderboard" class="result-board hidden" role="list"></div>
        </div>
              </div>
            </div>
            <aside class="keypad-panel" aria-label="テンキー">
              <div class="keypad-head">
                <div class="keypad-label">入力</div>
                <div id="keypadDisplay" class="keypad-display">____</div>
              </div>
              <div class="keypad" id="keypad">
                <button data-key="7" type="button">7</button>
                <button data-key="8" type="button">8</button>
                <button data-key="9" type="button">9</button>
                <button data-key="4" type="button">4</button>
                <button data-key="5" type="button">5</button>
                <button data-key="6" type="button">6</button>
                <button data-key="1" type="button">1</button>
                <button data-key="2" type="button">2</button>
                <button data-key="3" type="button">3</button>
                <button data-action="clear" class="function function--clear" type="button">CLR</button>
                <button data-key="0" class="zero" type="button">0</button>
                <button data-action="enter" class="function function--enter" type="button">ENTER</button>
              </div>
            </aside>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div id="flashOverlay" class="flash-overlay hidden" aria-hidden="true"></div>
  <div id="videoOverlay" class="video-overlay hidden" aria-hidden="true">
    <video id="explosionVideo" playsinline preload="auto"></video>
    <div id="videoFallback" class="video-message hidden">
      <p>爆発動画が設定されていません。</p>
      <p>運営画面で動画ファイルを選択してください。</p>
    </div>
  </div>
  <div id="rewardOverlay" class="video-overlay hidden" aria-hidden="true">
    <video id="rewardVideo" playsinline preload="auto" controls></video>
  </div>

  <audio id="beep" preload="auto" src="audio/1秒刻みBEEP.mp3"></audio>
  <audio id="enterTone" preload="auto" src="audio/BEEP入力音.mp3"></audio>
  <audio id="warningTone" preload="auto" src="audio/BEEP警告音.mp3"></audio>
  <audio id="errorTone" preload="auto" src="audio/BEEP警告音.mp3"></audio>
    <script src="app.js"></script>
</body>
</html>







